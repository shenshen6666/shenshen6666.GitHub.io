<!DOCTYPE html>
<html lang="zh-cmn-Hans">
<head>
  <!-- 包含 head 部分，动态设置页面标题 -->
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<title>使用 Spring Security 实现基于 Key 的认证 | 申申丫的</title>
<link rel="stylesheet" href="https://shenshen6666.GitHub.io/styles/main.css">
<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  <script src="https://shenshen6666.GitHub.io/media/js/page.js"></script>

    

  <!-- 页面描述信息 -->
  <meta name="description" content="教程：使用 Spring Security 实现基于 Key 的认证
在 Web 应用程序中，保护用户数据和敏感信息是至关重要的。Spring Security 是一个功能强大的框架，可以帮助我们轻松实现身份验证和授权功能。本教程将指导你如...">
  <!-- 引入 jQuery -->
  <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
  <!-- 代码高亮库 Prism.js -->
  <script src="https://shenshen6666.GitHub.io/media/js/prism.js"></script>
  <!-- KaTeX数学公式样式 -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css">
  <!-- Gitalk评论样式 -->
  <link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css">
  <!-- 引入 Gitalk评论功能脚本 -->
  <script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>

  <!-- 页面样式 -->
  <style>
    /* 网址模块样式 */
    .zhihu-iframe {
      position: fixed;
      top: 5px; /* 初始状态悬浮在页面上方 */
      left: 75%; /* 距离左边界75%的位置 */
      transform: translateX(-50%);
      z-index: 999;
      display: none; /* 初始状态隐藏网址模块 */
    }

    /* 按钮样式 */
    #toggleButton, #moveUpButton, #moveDownButton {
      cursor: pointer;
      position: fixed;
      bottom: 20px;
      right: 50px; /* 按钮距离右边界50px的位置 */
      padding: 10px;
      background-color: transparent;
      color: #000000;
      border: none;
      border-radius: 5px;
      margin: 5px;
    }

    /* 修复按钮样式 */
    #moveUpButton, #moveDownButton {
      bottom: 70px; /* 上移、下移按钮的位置 */
    }

    #moveDownButton {
      bottom: 120px; /* 下移按钮的位置 */
    }
  </style>
</head>
<body>
  <div class="antialiased">
    <div class="body-width mx-auto px-6 md:px-8">
      <!-- 包含页面头部 -->
      
<div class="flex justify-between items-center mt-10">
  <h1 class="text-lg sm:text-xl md:text-2xl lg:text-3xl text-gray-900 font-medium md:font-normal leading-none">
    <div class="glitch-wrapper">
      <div class="glitch" data-text="申申丫的">
        <a href="https://shenshen6666.GitHub.io">申申丫的</a>
      </div>
    </div>
  </h1>
  <div class="block lg:hidden" id="thumb-menu">
    <button id="thumb-open" type="button" class="block">
      <i class="icon icon-menu-close"></i>
    </button>
    <button id="thumb-close" type="button" class="hidden">
      <i class="icon icon-menu-open"></i>
    </button>
  </div>
</div>
<div id="nav-list" class="lg:block hidden">
  <div class="w-full block lg:flex lg:justify-between border-external-bottom lg:border-gray-400 mt-10 text-gray-700 lg:text-lg">
    <div class="lg:flex -mb-px">
      
        
          <div class="pb-4">
            <a href="/" class="nav-link">
              <i class="icon icon-home"></i> 
              首页
            </a>
          </div>
        
      
        
          <div class="pb-4">
            <a href="/archives" class="nav-link">
              <i class="icon icon-archive"></i> 
              归档
            </a>
          </div>
        
      
        
          <div class="pb-4">
            <a href="/tags" class="nav-link">
              <i class="icon icon-tags"></i> 
              标签
            </a>
          </div>
        
      
        
          <div class="pb-4">
            <a href="/post/about" class="nav-link">
              <i class="icon icon-user"></i> 
              关于
            </a>
          </div>
        
      
        
          <div class="pb-4">
            <a href="/essays" class="nav-link">
              <i class="icon icon-"></i> 
              测试菜单
            </a>
          </div>
        
      
      <div class="search-frame pb-4">
        <i class="icon icon-search"></i>
        <form id="search-form" action="https://shenshen6666.GitHub.io/search/">
          <input name="searchContent" type="text" placeholder="Search..." />
        </form>
      </div>
    </div>
    <div class="lg:flex">
      <ul>
        
          
        
          
        
          
        
          
        
          
        
          
        
      </ul>
      <a href="https://shenshen6666.GitHub.io/atom.xml" class="block mt-4 lg:mt-0 lg:ml-8 align-center hover:text-gray-900" target="_blank">
        <i class="icon icon-rss"></i>
        RSS
      </a>
    </div>
  </div>
</div>
      <!-- 页面主体 -->
      <div class="mb-20 md:flex mt-10 lg:mt-6 md:border-internal md:border-gray-400 md:pt-2 lg:border-t-0 lg:pt-0">
        <!-- 左侧内容 -->
        <div class="w-full md:w-2/3 mt-6">
          <!-- 文章标题 -->
          <h1 class="post-title text-3xl">使用 Spring Security 实现基于 Key 的认证</h1>
          <!-- 如果有特色图片，则显示 -->
          
            <img class="max-w-full mt-6 rounded-sm" src="https://img1.baidu.com/it/u=3340462857,598360889&amp;fm=253&amp;fmt=auto&amp;app=138&amp;f=JPEG?w=500&amp;h=500" alt="">
          
          <!-- 文章内容 -->
          <div class="mt-6 lg:mt-10 post-content">
            <h3 id="教程使用-spring-security-实现基于-key-的认证">教程：使用 Spring Security 实现基于 Key 的认证</h3>
<p>在 Web 应用程序中，保护用户数据和敏感信息是至关重要的。Spring Security 是一个功能强大的框架，可以帮助我们轻松实现身份验证和授权功能。本教程将指导你如何使用 Spring Security 实现基于 Key 的认证，确保只有持有有效 Key 的用户才能访问受保护的资源。</p>
<h3 id="1-准备工作">1. 准备工作</h3>
<p>在开始之前，请确保你的项目已经集成了 Spring Security，并且具有基本的配置。如果你还没有集成 Spring Security，请按照以下步骤进行集成：</p>
<h4 id="集成-spring-security-教程">集成 Spring Security 教程：</h4>
<ol>
<li>
<p><strong>添加 Maven 依赖</strong>：<br>
在项目的 <code>pom.xml</code> 文件中添加 Spring Security 的 Maven 依赖：</p>
<pre><code class="language-xml">&lt;dependency&gt;
    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
    &lt;artifactId&gt;spring-boot-starter-security&lt;/artifactId&gt;
&lt;/dependency&gt;
</code></pre>
</li>
<li>
<p><strong>创建 Spring Security 配置类</strong>：<br>
创建一个配置类，用于配置 Spring Security。这个配置类需要继承自 <code>WebSecurityConfigurerAdapter</code> 类，并添加 <code>@EnableWebSecurity</code> 注解。</p>
<pre><code class="language-java">import org.springframework.context.annotation.Configuration;
import org.springframework.security.config.annotation.web.configuration.EnableWebSecurity;
import org.springframework.security.config.annotation.web.configuration.WebSecurityConfigurerAdapter;

@Configuration
@EnableWebSecurity
public class SecurityConfig extends WebSecurityConfigurerAdapter {
    // 这里可以配置安全规则和其他相关的设置
}
</code></pre>
</li>
<li>
<p><strong>配置安全规则</strong>：<br>
在 <code>SecurityConfig</code> 类中，通过重写 <code>configure(HttpSecurity http)</code> 方法来配置安全规则。</p>
<pre><code class="language-java">@Override
protected void configure(HttpSecurity http) throws Exception {
    http
        .authorizeRequests()
            .antMatchers(&quot;/public/**&quot;).permitAll()
            .anyRequest().authenticated()
            .and()
        .formLogin()
            .loginPage(&quot;/login&quot;)
            .permitAll()
            .and()
        .logout()
            .permitAll();
}
</code></pre>
</li>
</ol>
<h3 id="2-创建-keyauthenticationconverter">2. 创建 KeyAuthenticationConverter</h3>
<p>首先，我们需要创建一个类 <code>KeyAuthenticationConverter</code> 来处理从请求中提取 Key 并转换为认证对象的逻辑。该类需要实现 Spring Security 的 <code>AuthenticationConverter</code> 接口。</p>
<pre><code class="language-java">// KeyAuthenticationConverter.java
public class KeyAuthenticationConverter implements AuthenticationConverter {
    // 实现逻辑...
    // 获取认证key 
    // 如果请求头中没有认证key，则尝试从请求参数中获取
    // 如果请求参数中没有认证key，则尝试从Cookie中获取
    return new KeyAuthenticationToken(key)
}
</code></pre>
<h3 id="3-创建-keyauthenticationprovider">3. 创建 KeyAuthenticationProvider</h3>
<p>接下来，我们需要创建一个认证提供者 <code>KeyAuthenticationProvider</code>，用于验证从 <code>KeyAuthenticationConverter</code> 中提取的认证对象。该类需要实现 Spring Security 的 <code>AuthenticationProvider</code> 接口。</p>
<pre><code class="language-java">// KeyAuthenticationProvider.java
public class KeyAuthenticationProvider implements AuthenticationProvider {
    // 实现逻辑...
    // 从KeyAuthenticationToken中获取认证key
    // 根据认证key查询key是否有请求权限
    // 根据认证key查询用户信息,找不到用户则表示key异常
    // 验证用户状态
    return new UserAuthenticationToken(&quot;用户信息&quot;,&quot;身份令牌&quot;);
}
</code></pre>
<h3 id="4-创建-keyauthenticationsuccesshandler">4. 创建 KeyAuthenticationSuccessHandler</h3>
<p>然后，我们创建一个认证成功处理器 <code>KeyAuthenticationSuccessHandler</code>，用于处理认证成功的情况。</p>
<pre><code class="language-java">// KeyAuthenticationSuccessHandler.java
public class KeyAuthenticationSuccessHandler implements AuthenticationSuccessHandler {
    // 实现逻辑...
    // 从认证信息中获取认证用户对象
    // 将认证用户相关信息放入请求头中
    request.setAttribute(&quot;用户信息&quot;);
}
</code></pre>
<h3 id="5-创建-keyauthenticationtoken">5. 创建 KeyAuthenticationToken</h3>
<p>我们还需要创建一个认证令牌 <code>KeyAuthenticationToken</code>，用于表示认证信息。</p>
<pre><code class="language-java">// KeyAuthenticationToken.java
public class KeyAuthenticationToken extends AbstractAuthenticationToken {
    // 实现逻辑...
    /**  
	 * * @param apiKey API 密钥  
	 */
    public KeyAuthenticationToken(String apiKey) {  
    super(null);  
    super.setAuthenticated(false);  
    this.apiKey = apiKey;  
}
}
</code></pre>
<h3 id="6-创建-securityconfigurer">6. 创建 SecurityConfigurer</h3>
<p>最后，我们创建一个配置类 <code>SecurityConfigurer</code>，用于配置 Spring Security。</p>
<pre><code class="language-java">// SecurityConfigurer.java
   @Configuration
   @EnableWebSecurity
   public class SecurityConfig extends WebSecurityConfigurerAdapter {
		// 参考准备工作
         @Override
   protected void configure(HttpSecurity http) throws Exception {
       http
           .authorizeRequests()
               .antMatchers(&quot;/public/**&quot;).permitAll()
               .anyRequest().authenticated()
               .and()
           .formLogin()
               .loginPage(&quot;/login&quot;)
               .permitAll()
               .and()
           .logout()
               .permitAll();
   }
   
   @Override  
	protected void configure(AuthenticationManagerBuilder auth) {   
	    auth.authenticationProvider(keyAuthenticationProvider);  
	}
	@Bean  
	public AuthenticationFilter keyAuthenticationFilter() throws Exception {  
	    AuthenticationFilter filter = new AuthenticationFilter(authenticationManager(), new KeyAuthenticationConverter());  
	    filter.setRequestMatcher(&quot;设置认证路由:/key/**&quot;);  
	    filter.setSuccessHandler(keyAuthenticationSuccessHandler());  
	    filter.setFailureHandler(authenticationEntryPointFailureHandler());  
	    return filter;  
}
   }
</code></pre>
<h3 id="7-创建测试">7. 创建测试</h3>
<pre><code class="language-java">@RequestMapping(&quot;/key&quot;)
public class OpenInstanceController {
    @GetMapping(&quot;/test&quot;)
    public String getTest() {
        return &quot;hello world !!!&quot;;
    }
}

</code></pre>
<p>通过以上步骤，我们成功地实现了基于 Spring Security 的 Key 认证流程。现在，持有有效 Key 的用户也能安全地访问受保护的资源。</p>

          </div>
        </div>
        <!-- 右侧内容 -->
        <div class="w-full md:w-1/3 mt-6 md:pl-8" id="additionalContent">
          <!-- 阅读模块相关内容 -->
          <div class="mt-6 md:pl-8">
            <!-- 发布时间 -->
            <h4 class="text-base font-thin text-gray-700 mb-2">
              <i class="icon icon-release"></i>
              发布时间
            </h4>
            <div class="text-lg mb-6">2024-04-24</div>
            <!-- 标签 -->
            <h4 class="text-base font-thin text-gray-700 mb-2">
              <i class="icon icon-tag"></i>
              标签
            </h4>
            <div class="mb-6">
              <!-- 循环显示标签 -->
              
            </div>
            <!-- 字数 -->
            <h4 class="text-base font-thin text-gray-700 mb-2">
              <i class="icon icon-words"></i>
              字数
            </h4>
            <div class="text-lg mb-6">901 Char</div>
            <!-- 阅读时间 -->
            <h4 class="text-base font-thin text-gray-700 mb-2">
              <i class="icon icon-read"></i>
              阅读时间
            </h4>
            <div class="text-lg mb-6">4 min read</div>
            <!-- 阅读量 -->
            <h4 class="text-base font-thin text-gray-700 mb-2">
              <i class="icon icon-times"></i>
              阅读量
            </h4>
            <div class="text-lg mb-6"><span id="busuanzi_value_page_pv"></span> Times</div>
            <!-- 相关阅读 -->
            <h4 class="text-base font-thin text-gray-700 mb-2">
              <i class="icon icon-related"></i>
              相关阅读
            </h4>
            <div class="border-internal border-gray-400">
              

  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  


  <div class="py-6 text-gray-700 text-sm">暂无相关文章</div>

            </div>
            <!-- 赞助内容 -->
            
  <h4 class="text-base font-thin text-gray-700 mb-2 mt-6">
    <i class="icon icon-sponsor"></i>
    赞赏
  </h4>
  <div class="post-sponsor text-gray-700">
    <img class="post-sponsor-img w-32 h-32 md:w-40 md:h-40" src="https://shenshen6666.GitHub.io\media\images\custom-weChatPayQR.png" alt="">
    <div>
      <i class="icon icon-wechat"></i>
      支付宝扫一扫领红包
    </div>
  </div>


          </div>
          <!-- 网址模块 -->
          <div class="zhihu-iframe mt-6">
            <!-- 添加网址模块地址的 iframe 代码 -->
            <iframe src="https://onehu.xyz/" width="100%" height="400px" frameborder="0" scrolling="yes"></iframe>
          </div>
          <!-- 切换按钮 -->
          <button id="toggleButton">切换</button>
          <!-- 上移按钮 -->
          <button id="moveUpButton">上</button>
          <!-- 下移按钮 -->
          <button id="moveDownButton">下</button>
        </div>
      </div>
      <!-- 页面底部内容 -->
      <!-- 其他内容省略 -->
      <div class="footer border-gray-400 border-external-top pt-6 mt-6 sm:mt-8 md:mt-10 mb-20 text-gray-700 text-sm sm:text-base lg:text-lg">
  Powered by <a href="https://github.com/shenshen6666/shenshen6666.GitHub.io" target="_blank">我的小屋</a>
</div>
    </div>
  </div>
  <!-- 页面脚本 -->
  <script>
    // 初始状态
    let isZhihuVisible = false;

    // 切换按钮点击事件
    $('#toggleButton').on('click', function() {
      $('.zhihu-iframe, #additionalContent .mt-6').toggle();
      // 这里可以添加其他模块的切换逻辑
    });

    // 上移按钮点击事件
    $('#moveUpButton').on('click', function() {
      let currentPosition = parseFloat($('.zhihu-iframe').css('top'));
      $('.zhihu-iframe').css('top', currentPosition - 10 + 'px');
    });

    // 下移按钮点击事件
    $('#moveDownButton').on('click', function() {
      let currentPosition = parseFloat($('.zhihu-iframe').css('top'));
      $('.zhihu-iframe').css('top', currentPosition + 10 + 'px');
    });

    // 代码高亮
    Prism.highlightAll();
  </script>
</body>
</html>
